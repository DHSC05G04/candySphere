<!DOCTYPE html>
<html lang="pt-br">

<%- include('../partials/head') %>

<body>
    <%- include('../partials/header') %>
    <main id="funcionarios">
        <section id="tabela-corpo">
            <table id="tabela-funcionario">
                <thead>
                    <tr>
                        <th id="titulo-card-ver-funcionario">
                            <div><i class='fas fa-id-card-alt' style='font-size:30px;'></i></a><span>
                                    Funcionario</span></div>
                            <!-- <%  if(usuarioCadastrado.length <=0){ %>
                                    <div id="card-usuario">
                                        <div class="add-funcionario"> <a id="btn-add" href="#"><span
                                                    class="material-icons btn-edicao">person_add_alt_1</span></a></div>
                                    </div>
                                </div>
                                <%    }else{ %>
                                <div style="display: flex;flex-wrap: wrap;">
                                    <div id="card-usuario">
                                        <div class="add-funcionario"> <a id="btn-edit" href="#"><i
                                                    class='fas fa-user-edit btn-edicao'></i></a></div>
                                    </div>
                                    <div id="card-usuario">
                                        <div class="add-funcionario"> <a  id="btn-excluir" href="#"><i
                                                    class='fas fa-trash btn-edicao'></i></a></div>
                                    </div>
                                </div>
                            </div>
                                <%  } %>
                            </div> -->
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="nome-campo">
                            <div id="foto-perfil">
                                <div style="width: 90px;"> <img src="/images/avatar/<%= funcionarios[0].avatar%> "
                                        width="100%" alt=""></div>
                                <div id="nome-funcionario"> <span id="nome"><%=funcionarios[0].nome%></span> </div>
                            </div>
                            <div class="funcionarios-dados">
                                <div>
                                    <label class="label-funcionario" for=""><b>Dados Cadastrais</b></label>
                                    <div><b>Email: </b> <span id="email"><%=funcionarios[0].email %></span></div>
                                    <div><b>Telefone: </b><span id="telefone"><%=funcionarios[0].telefone%></span></div>
                                    <div><b>Logradouro: </b><%=funcionarios[0].endereco%></div>
                                </div>
                            </div>
                            <div class="funcionarios-dados">
                                <div>
                                    <label class="label-funcionario" for=""><b>Dados Funcionais</b></label>
                                    <div><b>Cargo: </b> - </div>
                                    <div><b>Salário:R$ </b><%=funcionarios[0].salario%></div>
                                    <div><b>Data de Admisão:
                                        </b><%=moment(funcionarios[0].createdAt).format("DD/MM/YYYY")%></div>
                                </div>
                            </div>
                            <div class="funcionarios-dados">
                                <div id="usuario-dados">
                                    <label class="label-funcionario" for=""><b>Usuário do Sistema</b></label>
                                    <div>
                                        <%  if(usuarioCadastrado.length <=0){ %>
                                        <div><b>Usuario do Sistema: </b>Não Cadastado</div>
                                        <%    }else{ %>
                                        <div><b>Usuario: </b><%=usuarioCadastrado[0].nome_usuario%></div>
                                        <% if(usuarioCadastrado[0].acesso == 1){%>
                                        <div><b>acesso: </b> ADM </div>
                                        <% }else if(usuarioCadastrado[0].acesso==2){ %>
                                        <div><b>acesso: </b> USER </div>
                                        <%}%>

                                        <div><b>Data de Incio:
                                            </b><%=moment(usuarioCadastrado[0].createdAt).format("DD/MM/YYYY")%>
                                    </div>
                                    <%  } %>
                                </div>
                                <%  if(usuarioCadastrado.length <=0){ %>
                                <div id="card-usuario">
                                    <div class="add-funcionario"> <a id="btn-add" href="/usuarios"><span
                                                class="material-icons btn-edicao">person_add_alt_1</span></a></div>
                                </div>
                            </div>
                            <%    }else{ %>
                            <div style="display: flex;flex-wrap: wrap;">
                                <div id="card-usuario">
                                    <div class="add-funcionario"> <a id="btn-edit" href="#"><i
                                                class='fas fa-user-edit btn-edicao'></i></a></div>
                                </div>
                                <div id="card-usuario">
                                    <div class="add-funcionario"> <a id="btn-excluir" href="/usuarios"><i
                                                class='fas fa-trash btn-edicao'></i></a></div>
                                </div>
                            </div>
                            </div>
                            <%  } %>
                            </div>
                            </div>
                        </td>
                </tbody>
            </table>
        </section>
    </main>
    <br>
    <div id="modal-usuario" class="modal-container">
        <div id="conteudo-modal">
            <form id="form-cliente" class="form-usuario" method="POST" action="/usuarios" name="form-usuario"
                style="position: relative;">
                <h1 id="titulo">Cadastro de Usuário</h1>
                <button id="fechar-tudo" class="fechar-modal">x</button>
                <input type="hidden" id="id" name="id" value="<%=funcionarios[0].id%> ">
                <div id="label-cliente"><label for="nome-cliente">Nome de Usuário</label></div>
                <input type="text" id="nome-usuario" class="input-cadastro" name="nome"
                    placeholder="Digite o nome de Usuario" value="<%=funcionarios[0].email%>">
                <div id="label-cliente"><label id="label-acesso" for="nome-cliente">Privilégio</label></div>
                <select type="select" id="acesso" class="input-cadastro" name="nivel">
                    <option value="" disabled selected>Escolha o nível de acesso</option>
                    <option value="1">ADM</option>
                    <option value="2">USER</option>
                </select>
                <div id="label-cliente"><label id="nova-senha" for="nome-cliente">Senha</label></div>
                <input type="password" id="senha" class="input-cadastro" value="<%=funcionarios[0].email%>" name="senha"
                    placeholder="Digite uma senha">

                <input type="submit" id="input-usuario" onclick="" class="btn-cliente btn-submit" value="Salvar">
            </form>
        </div>
    </div>


    <!-- Modal Delete -->
    <div id="modal-delete" class="modal-container">
        <div id="conteudo-modal">
            <form id="form-cliente" class="form-del" method="POST" action="/usuarios?_method=DELETE">
                <input id="id-del" name="id" type="hidden" value="">
                <div class="btn-fechar"> <button id="fechar-tudo" class="fechar-modal">x</button></div>
                <h1 id="titulo"> <span class="material-icons">
                        delete
                    </span> - Delete de Usuário</h1>
                <div id="label-cliente"><label for="nome-cliente" id="label-nome">
                        <h3>Tem certeza que vai deletar o Usuário?</h3>
                    </label></div>
                <div id="btn-modal"> <input type="submit" class="btn-cliente" value="Deletar">
                    <input type="submit" id="cancela" class="btn-cliente" value="Cancelar"></div>

            </form>
        </div>
    </div>
    <!-- Fim de Modal Usuário -->

    <%- include('../partials/footer') %>
    <%- include('../partials/scripts') %>
    <script>
        function iniciaModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('mostrar');
            modal.addEventListener('click', (e) => {
                if (e.target.id == 'fechar-tudo') {
                    e.preventDefault();
                    modal.classList.remove('mostrar');
                }
            });
        }
        const btnUsuarioAdd = document.querySelector('#btn-add');
        btnUsuarioAdd.addEventListener('click', (e) => {
            e.preventDefault()
            const confirmaSenha = document.querySelector("#confirma-senha")
            const confirmaLabelSenha = document.querySelector("#confirmaLabel-senha")

            iniciaModal('modal-usuario');
        });
    </script>
    <script>
        const submit = document.querySelector(".btn-submit")
        const labelAcesso = document.querySelector("#label-acesso")
        const form = document.querySelector('#input-usuario');
        submit.addEventListener('click', (e) => {
            const acesso = document.querySelector("#acesso")
            const opt = acesso.value
            form.action = '/usuarios'
            if (opt == "" | opt == undefined) {
                e.preventDefault()
                acesso.style.border = "2px solid red"
                labelAcesso.style.color = "red"
                labelAcesso.innerHTML = 'Privilégio - escolha o nível de acesso'
            }


        })
    </script>
    '<%if(usuarioCadastrado.length >0){%>'
    <script>
        const btnUsuarioEdit = document.querySelector('#btn-edit');
        const id = document.querySelector('#id');
        const titulo = document.querySelector('#titulo');
        const usuario = document.querySelector('#nome-usuario');
        const acesso = document.querySelector('#acesso');
        const senha = document.querySelector('#nova-senha');
        const inputUsuario = document.querySelector('#input-usuario');
        const btnExcluir = document.querySelector('#btn-excluir');


        btnUsuarioEdit.addEventListener('click', () => {
            form1 = document.querySelector('form');
            form1.action = "/usuarios?_method=PUT"
            inputUsuario.value = "Atualizar"
            titulo.textContent = "Atualizar Usuário"
            senha.textContent = "Nova Senha"
            id.value = '<%=usuarioCadastrado[0].id%>'
            usuario.value = '<%=usuarioCadastrado[0].nome_usuario%>'
            acesso.value = '<%=usuarioCadastrado[0].acesso%>'
            iniciaModal('modal-usuario');
        });

        formDel = document.querySelector('.form-del');
        idDelete = document.querySelector('#id-del');
        btnExcluir.addEventListener('click', (e) => {
            e.preventDefault()
            formDel.action = "/usuarios?_method=DELETE"
            idDelete.value = "<%=usuarioCadastrado[0].id%>"
            iniciaModal('modal-delete')
        })
    </script>
    '<%}%>'
</body>

</html>